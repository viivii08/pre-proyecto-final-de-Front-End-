<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo Mejoras JavaScript - Patagonia Style</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
      padding: 20px 0;
    }
    .demo-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .demo-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .code-example {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 14px;
      overflow-x: auto;
      margin: 15px 0;
    }
    .demo-output {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      min-height: 100px;
    }
    .btn-demo {
      margin: 5px;
    }
    .log-output {
      background: #2d3748;
      color: #a0aec0;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin: 15px 0;
    }
    .feature-badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    
    <!-- Header -->
    <div class="text-center mb-5">
      <h1 class="display-4 text-primary mb-3">üöÄ Demo de Mejoras JavaScript</h1>
      <p class="lead text-muted">Patagonia Style - Sistema optimizado con logging, validaciones y debugging avanzado</p>
      <div>
        <span class="feature-badge">‚úÖ Validaciones Robustas</span>
        <span class="feature-badge">üìä Logging Estructurado</span>
        <span class="feature-badge">üîç Debug Avanzado</span>
        <span class="feature-badge">‚ö° Rendimiento Optimizado</span>
      </div>
    </div>

    <!-- Secci√≥n 1: Sistema de Logging -->
    <div class="demo-section">
      <h2><i class="bi bi-terminal"></i> Sistema de Logging Avanzado</h2>
      <p class="text-muted">Logging estructurado con niveles, timestamps y formateo profesional</p>
      
      <div class="row">
        <div class="col-md-6">
          <h5>Controles de Demo:</h5>
          <button onclick="demoLogging('debug')" class="btn btn-sm btn-secondary btn-demo">Debug</button>
          <button onclick="demoLogging('info')" class="btn btn-sm btn-primary btn-demo">Info</button>
          <button onclick="demoLogging('warn')" class="btn btn-sm btn-warning btn-demo">Warning</button>
          <button onclick="demoLogging('error')" class="btn btn-sm btn-danger btn-demo">Error</button>
          <button onclick="clearLogDemo()" class="btn btn-sm btn-outline-dark btn-demo">Limpiar</button>
        </div>
        <div class="col-md-6">
          <h5>Nivel de Log:</h5>
          <select onchange="cambiarNivelLog(this.value)" class="form-select form-select-sm">
            <option value="DEBUG">DEBUG (todos los logs)</option>
            <option value="INFO" selected>INFO (info, warn, error)</option>
            <option value="WARN">WARN (solo warn y error)</option>
            <option value="ERROR">ERROR (solo errores)</option>
          </select>
        </div>
      </div>
      
      <div class="log-output" id="logOutput">
        <div>üè™ [INFO] Sistema de logging inicializado</div>
        <div>üí° Presiona los botones de arriba para ver diferentes tipos de logs</div>
      </div>
    </div>

    <!-- Secci√≥n 2: Validaciones -->
    <div class="demo-section">
      <h2><i class="bi bi-shield-check"></i> Sistema de Validaciones</h2>
      <p class="text-muted">Validaciones robustas con manejo de casos l√≠mite</p>
      
      <div class="row">
        <div class="col-md-6">
          <h5>Test de Validaciones de Producto:</h5>
          <button onclick="testValidarProducto('valido')" class="btn btn-sm btn-success btn-demo">Producto V√°lido</button>
          <button onclick="testValidarProducto('sin_stock')" class="btn btn-sm btn-warning btn-demo">Sin Stock</button>
          <button onclick="testValidarProducto('inexistente')" class="btn btn-sm btn-danger btn-demo">No Existe</button>
          <button onclick="testValidarProducto('cantidad_alta')" class="btn btn-sm btn-info btn-demo">Cantidad Alta</button>
        </div>
        <div class="col-md-6">
          <h5>Test de B√∫squeda:</h5>
          <input type="text" class="form-control form-control-sm mb-2" placeholder="T√©rmino de b√∫squeda" id="searchTest">
          <button onclick="testValidarBusqueda()" class="btn btn-sm btn-primary btn-demo">Validar B√∫squeda</button>
          <button onclick="testBusquedaCompleta()" class="btn btn-sm btn-outline-primary btn-demo">Buscar Productos</button>
        </div>
      </div>
      
      <div class="demo-output" id="validationOutput">
        <strong>Resultados de validaci√≥n aparecer√°n aqu√≠...</strong>
      </div>
    </div>

    <!-- Secci√≥n 3: Formateo Mejorado -->
    <div class="demo-section">
      <h2><i class="bi bi-palette"></i> Utilidades de Formato</h2>
      <p class="text-muted">Formateo consistente para precios, descuentos y stock</p>
      
      <div class="row">
        <div class="col-md-4">
          <h5>Formato de Precios:</h5>
          <button onclick="demoFormatear('precio', 25900)" class="btn btn-sm btn-outline-success btn-demo">$25,900</button>
          <button onclick="demoFormatear('precio', 1500.75)" class="btn btn-sm btn-outline-success btn-demo">$1,500.75</button>
          <button onclick="demoFormatear('precio', 0)" class="btn btn-sm btn-outline-secondary btn-demo">$0</button>
        </div>
        <div class="col-md-4">
          <h5>Descuentos:</h5>
          <button onclick="demoFormatear('descuento', [23900, 21900])" class="btn btn-sm btn-outline-warning btn-demo">8% OFF</button>
          <button onclick="demoFormatear('descuento', [10000, 7500])" class="btn btn-sm btn-outline-warning btn-demo">25% OFF</button>
        </div>
        <div class="col-md-4">
          <h5>Estado de Stock:</h5>
          <button onclick="demoFormatear('stock', 0)" class="btn btn-sm btn-outline-danger btn-demo">Sin Stock</button>
          <button onclick="demoFormatear('stock', 3)" class="btn btn-sm btn-outline-warning btn-demo">Poco Stock</button>
          <button onclick="demoFormatear('stock', 25)" class="btn btn-sm btn-outline-success btn-demo">Disponible</button>
        </div>
      </div>
      
      <div class="demo-output" id="formatOutput">
        <strong>Ejemplos de formato aparecer√°n aqu√≠...</strong>
      </div>
    </div>

    <!-- Secci√≥n 4: Rendimiento -->
    <div class="demo-section">
      <h2><i class="bi bi-speedometer2"></i> M√©tricas de Rendimiento</h2>
      <p class="text-muted">Medici√≥n de performance y optimizaci√≥n de operaciones</p>
      
      <div class="row">
        <div class="col-md-6">
          <h5>Tests de Performance:</h5>
          <button onclick="testRendimiento('busqueda')" class="btn btn-sm btn-primary btn-demo">B√∫squeda Masiva</button>
          <button onclick="testRendimiento('render')" class="btn btn-sm btn-success btn-demo">Renderizado</button>
          <button onclick="testRendimiento('validacion')" class="btn btn-sm btn-warning btn-demo">Validaciones</button>
          <button onclick="mostrarEstadisticas()" class="btn btn-sm btn-info btn-demo">Estad√≠sticas</button>
        </div>
        <div class="col-md-6">
          <h5>Dashboard de Debug:</h5>
          <button onclick="mostrarDebugDashboard()" class="btn btn-sm btn-secondary btn-demo">Debug Completo</button>
          <button onclick="limpiarConsola()" class="btn btn-sm btn-outline-dark btn-demo">Limpiar Consola</button>
        </div>
      </div>
      
      <div class="demo-output" id="performanceOutput">
        <strong>Resultados de performance aparecer√°n aqu√≠...</strong>
      </div>
    </div>

    <!-- Secci√≥n 5: Console Output -->
    <div class="demo-section">
      <h2><i class="bi bi-code-square"></i> Output de Consola en Vivo</h2>
      <p class="text-muted">Todas las operaciones se registran en la consola del navegador. <strong>Abre DevTools (F12)</strong> para ver los logs detallados.</p>
      
      <div class="alert alert-info">
        <i class="bi bi-info-circle"></i>
        <strong>Tip:</strong> Presiona <code>F12</code> para abrir las herramientas de desarrollador y ver todos los logs estructurados, tablas de datos y m√©tricas de rendimiento en tiempo real.
      </div>
      
      <div class="text-center">
        <button onclick="demoCompleto()" class="btn btn-lg btn-gradient">
          üöÄ Ejecutar Demo Completo
        </button>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Nuestros sistemas mejorados -->
  <script src="js/code-improvements.js"></script>
  
  <!-- Mock data para demo -->
  <script>
    // Datos de prueba para la demo
    const mockProducts = [
      {
        id: 1,
        nombre: "Jarro Zorrito Invierno",
        precio: 21900,
        precioOriginal: 23900,
        stock: 15,
        disponible: true,
        categoria: "jarros",
        descripcionCorta: "Jarro enlozado inspirado en la Patagonia",
        imagenes: ["pages/jarroportada.webp"],
        tags: ["jarro", "enlozado", "patagonia", "zorrito"]
      },
      {
        id: 2,
        nombre: "Cuaderno Zorro",
        precio: 18900,
        precioOriginal: 21900,
        stock: 3,
        disponible: true,
        categoria: "papeleria",
        descripcionCorta: "Cuaderno anillado A4 con dise√±o original",
        imagenes: ["pages/cuadernoportada.webp"],
        tags: ["cuaderno", "anillado", "a4", "zorro"]
      },
      {
        id: 3,
        nombre: "Yerbera Bariloche",
        precio: 24900,
        stock: 0,
        disponible: false,
        categoria: "accesorios",
        descripcionCorta: "Yerbera ilustrada con paisajes de monta√±a",
        imagenes: ["pages/yerbraportada.webp"],
        tags: ["yerbera", "bariloche", "monta√±a"]
      }
    ];

    // Funciones de demo
    function demoLogging(tipo) {
      const logData = {
        timestamp: new Date().toISOString(),
        user: 'Demo User',
        action: `demo_${tipo}`,
        productos: mockProducts.length
      };

      switch(tipo) {
        case 'debug':
          PatagoniaLogger.debug('Mensaje de debug de ejemplo', logData);
          break;
        case 'info':
          PatagoniaLogger.info('Informaci√≥n del sistema', logData);
          break;
        case 'warn':
          PatagoniaLogger.warn('Advertencia de ejemplo', { issue: 'Stock bajo en algunos productos' });
          break;
        case 'error':
          PatagoniaLogger.error('Error simulado', new Error('Error de demostraci√≥n'), { context: 'demo' });
          break;
      }

      updateLogOutput(`[${tipo.toUpperCase()}] Log generado - ver consola para detalles`);
    }

    function testValidarProducto(tipo) {
      let producto, cantidad = 1;
      
      switch(tipo) {
        case 'valido':
          producto = mockProducts[0]; // Jarro con stock
          break;
        case 'sin_stock':
          producto = mockProducts[2]; // Yerbera sin stock
          break;
        case 'inexistente':
          producto = null;
          break;
        case 'cantidad_alta':
          producto = mockProducts[0];
          cantidad = 150; // M√°s del l√≠mite
          break;
      }

      const resultado = ProductValidator.validateCartOperation(producto, cantidad);
      
      document.getElementById('validationOutput').innerHTML = `
        <div class="alert alert-${resultado.isValid ? 'success' : 'warning'}">
          <strong>Resultado:</strong> ${resultado.isValid ? '‚úÖ V√°lido' : '‚ùå Inv√°lido'}<br>
          ${resultado.message ? `<strong>Mensaje:</strong> ${resultado.message}<br>` : ''}
          ${resultado.code ? `<strong>C√≥digo:</strong> ${resultado.code}` : ''}
        </div>
        <pre><strong>Datos de entrada:</strong>
Producto: ${producto ? producto.nombre : 'null'}
Cantidad: ${cantidad}
Stock: ${producto ? producto.stock : 'N/A'}</pre>
      `;
    }

    function testValidarBusqueda() {
      const termino = document.getElementById('searchTest').value;
      const resultado = ProductValidator.validateSearchTerm(termino);
      
      document.getElementById('validationOutput').innerHTML = `
        <div class="alert alert-${resultado.isValid ? 'success' : 'warning'}">
          <strong>B√∫squeda:</strong> "${termino}"<br>
          <strong>V√°lida:</strong> ${resultado.isValid ? '‚úÖ S√≠' : '‚ùå No'}<br>
          ${resultado.message ? `<strong>Mensaje:</strong> ${resultado.message}<br>` : ''}
          ${resultado.sanitizedTerm ? `<strong>T√©rmino sanitizado:</strong> "${resultado.sanitizedTerm}"` : ''}
        </div>
      `;
    }

    function testBusquedaCompleta() {
      const startTime = performance.now();
      const termino = document.getElementById('searchTest').value;
      const terminoSanitizado = FormatUtils.sanitizeSearchTerm(termino);
      
      const resultados = mockProducts.filter(producto => 
        producto.nombre.toLowerCase().includes(terminoSanitizado) ||
        producto.descripcionCorta.toLowerCase().includes(terminoSanitizado) ||
        producto.tags?.some(tag => tag.toLowerCase().includes(terminoSanitizado))
      );
      
      PatagoniaLogger.performance('B√∫squeda de demo', startTime);
      
      document.getElementById('validationOutput').innerHTML = `
        <div class="alert alert-info">
          <strong>B√∫squeda ejecutada:</strong> "${termino}"<br>
          <strong>T√©rmino procesado:</strong> "${terminoSanitizado}"<br>
          <strong>Resultados encontrados:</strong> ${resultados.length} de ${mockProducts.length}
        </div>
        <div class="mt-2">
          ${resultados.map(p => `<span class="badge bg-primary me-1">${p.nombre}</span>`).join('')}
        </div>
      `;
    }

    function demoFormatear(tipo, valor) {
      let resultado;
      
      switch(tipo) {
        case 'precio':
          resultado = FormatUtils.formatPrice(valor);
          break;
        case 'descuento':
          resultado = FormatUtils.formatDiscount(valor[0], valor[1]);
          break;
        case 'stock':
          resultado = FormatUtils.formatStock(valor);
          break;
      }

      let html = `<strong>Entrada:</strong> ${Array.isArray(valor) ? valor.join(' ‚Üí ') : valor}<br>`;
      html += `<strong>Resultado:</strong> ${JSON.stringify(resultado, null, 2)}`;
      
      document.getElementById('formatOutput').innerHTML = `<pre>${html}</pre>`;
    }

    function testRendimiento(tipo) {
      const startTime = performance.now();
      let resultado;

      switch(tipo) {
        case 'busqueda':
          // Simular b√∫squedas masivas
          for(let i = 0; i < 1000; i++) {
            mockProducts.filter(p => p.nombre.includes('o'));
          }
          resultado = '1,000 b√∫squedas simuladas';
          break;
        case 'render':
          // Simular renderizado de elementos
          for(let i = 0; i < 100; i++) {
            const div = document.createElement('div');
            div.innerHTML = `<span>${mockProducts[0].nombre}</span>`;
          }
          resultado = '100 elementos DOM creados';
          break;
        case 'validacion':
          // Validaciones masivas
          for(let i = 0; i < 500; i++) {
            ProductValidator.validateCartOperation(mockProducts[0], 1);
          }
          resultado = '500 validaciones ejecutadas';
          break;
      }

      const duration = performance.now() - startTime;
      PatagoniaLogger.performance(`Test ${tipo}`, startTime);

      document.getElementById('performanceOutput').innerHTML = `
        <div class="alert alert-success">
          <strong>Test:</strong> ${tipo}<br>
          <strong>Operaci√≥n:</strong> ${resultado}<br>
          <strong>Tiempo:</strong> ${duration.toFixed(2)}ms<br>
          <strong>Promedio por operaci√≥n:</strong> ${(duration / (tipo === 'busqueda' ? 1000 : tipo === 'render' ? 100 : 500)).toFixed(4)}ms
        </div>
      `;
    }

    function mostrarEstadisticas() {
      const stats = {
        productos: mockProducts.length,
        categorias: [...new Set(mockProducts.map(p => p.categoria))].length,
        stockTotal: mockProducts.reduce((sum, p) => sum + p.stock, 0),
        valorTotal: mockProducts.reduce((sum, p) => sum + p.precio, 0),
        promedioStock: mockProducts.reduce((sum, p) => sum + p.stock, 0) / mockProducts.length
      };

      PatagoniaLogger.info('Estad√≠sticas del cat√°logo', stats);

      document.getElementById('performanceOutput').innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <h6>üìä Estad√≠sticas del Cat√°logo:</h6>
            <ul class="list-unstyled">
              <li><strong>Total productos:</strong> ${stats.productos}</li>
              <li><strong>Categor√≠as:</strong> ${stats.categorias}</li>
              <li><strong>Stock total:</strong> ${stats.stockTotal} unidades</li>
              <li><strong>Valor total:</strong> ${FormatUtils.formatPrice(stats.valorTotal)}</li>
              <li><strong>Promedio stock:</strong> ${stats.promedioStock.toFixed(1)} por producto</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6>üîç Ver en Consola:</h6>
            <p class="text-muted">Los detalles completos est√°n disponibles en la consola del navegador (F12).</p>
          </div>
        </div>
      `;
    }

    function mostrarDebugDashboard() {
      // Simular datos de usuario y carrito
      const mockStore = {
        productos: mockProducts,
        carrito: [
          { id: 1, nombre: mockProducts[0].nombre, cantidad: 2, precio: mockProducts[0].precio }
        ]
      };
      const mockUserManager = { isLoggedIn: () => true };

      PatagoniaLogger.debugDashboard(mockStore, mockUserManager);

      document.getElementById('performanceOutput').innerHTML = `
        <div class="alert alert-info">
          <i class="bi bi-terminal"></i>
          <strong>Dashboard de Debug generado!</strong><br>
          Abre la consola del navegador (F12) para ver el dashboard completo con:
          <ul class="mt-2 mb-0">
            <li>Estado de la aplicaci√≥n</li>
            <li>Estad√≠sticas del carrito</li>
            <li>Informaci√≥n de productos</li>
            <li>M√©tricas de rendimiento</li>
          </ul>
        </div>
      `;
    }

    function demoCompleto() {
      PatagoniaLogger.info('üöÄ INICIANDO DEMO COMPLETO');
      
      // Ejecutar todas las demos en secuencia
      setTimeout(() => demoLogging('info'), 100);
      setTimeout(() => testValidarProducto('valido'), 300);
      setTimeout(() => demoFormatear('precio', 25900), 500);
      setTimeout(() => testRendimiento('busqueda'), 700);
      setTimeout(() => mostrarDebugDashboard(), 1000);
      
      // Mostrar resumen final
      setTimeout(() => {
        PatagoniaLogger.info('‚úÖ Demo completo finalizado', {
          operaciones_ejecutadas: 5,
          tiempo_total: '1.2 segundos',
          sistema: 'Patagonia Style Improved'
        });
        
        alert('üéâ Demo completo ejecutado! Revisa la consola (F12) para ver todos los logs detallados.');
      }, 1200);
    }

    function cambiarNivelLog(nivel) {
      PatagoniaLogger.currentLevel = PatagoniaLogger.LOG_LEVELS[nivel];
      updateLogOutput(`üìä Nivel de log cambiado a: ${nivel}`);
    }

    function clearLogDemo() {
      document.getElementById('logOutput').innerHTML = '<div>üßπ Log limpiado</div>';
    }

    function updateLogOutput(mensaje) {
      const output = document.getElementById('logOutput');
      const timestamp = new Date().toLocaleTimeString();
      output.innerHTML += `<div>[${timestamp}] ${mensaje}</div>`;
      output.scrollTop = output.scrollHeight;
    }

    function limpiarConsola() {
      console.clear();
      PatagoniaLogger.info('Consola limpiada');
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      PatagoniaLogger.info('Demo de mejoras JavaScript cargado');
      updateLogOutput('üí° Demo listo - Explora las funcionalidades');
    });
  </script>

  <style>
    .btn-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      transition: transform 0.2s;
    }
    .btn-gradient:hover {
      transform: scale(1.05);
      color: white;
    }
  </style>
</body>
</html>