<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß Test Opciones Men√∫ - URGENTE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <style>
    body { 
      background: #e74c3c; 
      color: white; 
      font-family: Arial; 
      padding-top: 100px;
    }
    .urgente {
      background: white;
      color: #333;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <div id="navbar-container"></div>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="urgente">
          <h1 class="text-center text-danger mb-4">üö® TEST OPCIONES MEN√ö URGENTE</h1>
          
          <div class="alert alert-danger">
            <h4>üéØ PROBLEMA: Las opciones del men√∫ no aparecen</h4>
            <p>Vamos a solucionarlo AHORA MISMO</p>
          </div>

          <div class="text-center mb-4">
            <button class="btn btn-danger btn-lg" onclick="crearUsuarioYMostrarMenu()">
              üîß CREAR USUARIO Y FORZAR MEN√ö
            </button>
          </div>

          <div class="row">
            <div class="col-md-12">
              <h5>üìã Estado del Men√∫:</h5>
              <div id="menu-debug" class="border p-3 bg-light">
                Cargando debug...
              </div>
            </div>
          </div>

          <div class="mt-4">
            <h5>‚úÖ Opciones que DEBEN aparecer:</h5>
            <ul class="list-group">
              <li class="list-group-item d-flex align-items-center">
                <i class="bi bi-person me-2 text-primary"></i> Mi cuenta
              </li>
              <li class="list-group-item d-flex align-items-center">
                <i class="bi bi-box me-2 text-success"></i> Mis pedidos
              </li>
              <li class="list-group-item d-flex align-items-center">
                <i class="bi bi-box-arrow-right me-2 text-warning"></i> Cerrar Sesi√≥n
              </li>
            </ul>
          </div>

          <div class="mt-4 text-center">
            <button class="btn btn-warning me-2" onclick="debugCompleto()">
              üîç DEBUG COMPLETO
            </button>
            <button class="btn btn-success" onclick="mostrarMenuManual()">
              üí™ MOSTRAR MEN√ö MANUAL
            </button>
          </div>

          <div class="mt-4">
            <h6>üîß HTML del Men√∫ Generado:</h6>
            <textarea id="html-generado" class="form-control" rows="10" readonly></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Sistemas Profesionales -->
  <script src="js/validation.js"></script>
  <script src="js/loading.js"></script>
  <script src="js/error-manager.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/performance.js"></script>
  
  <!-- Sistemas Base -->
  <script src="js/store.js"></script>
  <script src="js/users.js"></script>
  <script src="js/universal-navbar.js"></script>

  <script>
    function crearUsuarioYMostrarMenu() {
      console.log('üö® Iniciando creaci√≥n de usuario...');
      
      // Crear usuario de prueba
      const usuario = {
        firstName: 'Viviana',
        lastName: 'Vargas',
        email: 'vivi_ana35@hotmail.com',
        phone: '+54 11 1234-5678',
        isVerified: true,
        registrationDate: new Date().toISOString()
      };
      
      localStorage.setItem('currentUser', JSON.stringify(usuario));
      localStorage.setItem('patagonia_user', JSON.stringify(usuario));
      
      console.log('‚úÖ Usuario creado:', usuario);
      
      // Esperar y forzar re-renderizado
      setTimeout(() => {
        if (window.universalNavbar) {
          console.log('üîÑ Forzando actualizaci√≥n del navbar...');
          window.universalNavbar.currentUser = usuario;
          window.universalNavbar.renderNavbar();
          
          // Obtener HTML generado
          const navbarContainer = document.getElementById('navbar-container');
          if (navbarContainer) {
            document.getElementById('html-generado').value = navbarContainer.innerHTML;
          }
          
          debugCompleto();
        }
      }, 100);
      
      alert('‚úÖ Usuario creado! Ahora haz clic en "viviana" en el navbar');
    }

    function debugCompleto() {
      let debug = '';
      
      // Estado del usuario
      const usuario = localStorage.getItem('currentUser');
      debug += `üë§ Usuario en localStorage: ${usuario ? '‚úÖ S√ç' : '‚ùå NO'}\n`;
      
      if (usuario) {
        const user = JSON.parse(usuario);
        debug += `   - Nombre: ${user.firstName} ${user.lastName}\n`;
        debug += `   - Email: ${user.email}\n`;
      }
      
      // Estado del navbar
      debug += `\nüß≠ Universal Navbar:\n`;
      debug += `   - Existe window.universalNavbar: ${window.universalNavbar ? '‚úÖ S√ç' : '‚ùå NO'}\n`;
      
      if (window.universalNavbar) {
        debug += `   - currentUser: ${window.universalNavbar.currentUser ? '‚úÖ S√ç' : '‚ùå NO'}\n`;
        debug += `   - cartCount: ${window.universalNavbar.cartCount}\n`;
      }
      
      // Estado del DOM
      debug += `\nüèóÔ∏è DOM:\n`;
      const navbarContainer = document.getElementById('navbar-container');
      debug += `   - navbar-container existe: ${navbarContainer ? '‚úÖ S√ç' : '‚ùå NO'}\n`;
      
      if (navbarContainer) {
        debug += `   - Tiene contenido: ${navbarContainer.innerHTML.length > 0 ? '‚úÖ S√ç' : '‚ùå NO'}\n`;
        debug += `   - Caracteres HTML: ${navbarContainer.innerHTML.length}\n`;
        
        const dropdownMenu = navbarContainer.querySelector('.dropdown-menu');
        debug += `   - Dropdown menu existe: ${dropdownMenu ? '‚úÖ S√ç' : '‚ùå NO'}\n`;
        
        if (dropdownMenu) {
          const opciones = dropdownMenu.querySelectorAll('.dropdown-item');
          debug += `   - Opciones encontradas: ${opciones.length}\n`;
          opciones.forEach((opcion, i) => {
            debug += `     ${i+1}. ${opcion.textContent.trim()}\n`;
          });
        }
      }
      
      document.getElementById('menu-debug').innerHTML = `<pre>${debug}</pre>`;
    }

    function mostrarMenuManual() {
      // Crear HTML del men√∫ manualmente
      const menuHTML = `
        <div class="dropdown" style="position: relative;">
          <button class="btn dropdown-toggle" type="button" id="manualDropdown" style="background: rgba(59,93,80,0.2); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 8px 12px;">
            Viviana (Manual)
          </button>
          
          <ul class="dropdown-menu show" style="position: absolute; top: 100%; right: 0; display: block; min-width: 280px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); padding: 10px 0; z-index: 1000;">
            
            <li style="padding: 15px 20px; background: #f8f9fa; margin-bottom: 10px; border-radius: 15px 15px 0 0;">
              <div style="display: flex; align-items: center;">
                <i class="bi bi-person-circle" style="font-size: 2rem; color: #1f3c5a; margin-right: 12px;"></i>
                <div>
                  <div style="font-weight: 600;">Viviana Vargas</div>
                  <div style="font-size: 0.85rem; color: #666;">vivi_ana35@hotmail.com</div>
                </div>
              </div>
            </li>
            
            <li>
              <a href="mi-cuenta.html" style="display: flex; align-items: center; padding: 12px 20px; color: #333; text-decoration: none;">
                <i class="bi bi-person" style="width: 20px; text-align: center; margin-right: 12px; color: #3b5d50;"></i>
                Mi cuenta
              </a>
            </li>
            
            <li>
              <a href="mis-pedidos.html" style="display: flex; align-items: center; padding: 12px 20px; color: #333; text-decoration: none;">
                <i class="bi bi-box" style="width: 20px; text-align: center; margin-right: 12px; color: #3b5d50;"></i>
                Mis pedidos
              </a>
            </li>
            
            <li><hr style="margin: 8px 0; border-color: #e9ecef;"></li>
            
            <li>
              <a href="#" onclick="alert('Logout!'); return false;" style="display: flex; align-items: center; padding: 12px 20px; color: #dc3545; text-decoration: none;">
                <i class="bi bi-box-arrow-right" style="width: 20px; text-align: center; margin-right: 12px;"></i>
                Cerrar Sesi√≥n
              </a>
            </li>
            
          </ul>
        </div>
      `;
      
      // Agregar al navbar
      const navbarContainer = document.getElementById('navbar-container');
      if (navbarContainer) {
        navbarContainer.innerHTML += `<div style="position: fixed; top: 20px; right: 20px; z-index: 2000;">${menuHTML}</div>`;
      }
      
      alert('‚úÖ Men√∫ manual creado! Mira arriba a la derecha');
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(debugCompleto, 1000);
      
      // Auto-debug cada 5 segundos
      setInterval(debugCompleto, 5000);
    });
  </script>
</body>
</html>