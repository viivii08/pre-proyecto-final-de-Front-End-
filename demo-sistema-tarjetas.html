<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Demo - Sistema Avanzado de Tarjetas de Productos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Nuestros estilos personalizados -->
    <link rel="stylesheet" href="css/product-cards.css">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .demo-header {
            background: linear-gradient(135deg, #3b5d50, #2d4a40);
            color: white;
            padding: 3rem 0 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .demo-controls {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .stats-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .btn-demo {
            border: none;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0.25rem;
        }

        .btn-primary-demo {
            background: linear-gradient(135deg, #3b5d50, #4a7c59);
            color: white;
        }

        .btn-primary-demo:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 93, 80, 0.3);
        }

        .btn-secondary-demo {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }

        .btn-warning-demo {
            background: linear-gradient(135deg, #ffc107, #ffb347);
            color: #212529;
        }

        .btn-danger-demo {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .feature-highlight {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b5d50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .template-selector {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }

        .template-option {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-option:hover {
            border-color: #3b5d50;
            background: rgba(59, 93, 80, 0.1);
        }

        .template-option.active {
            border-color: #3b5d50;
            background: rgba(59, 93, 80, 0.2);
        }

        .demo-section {
            margin: 3rem 0;
        }

        .demo-section h3 {
            color: #3b5d50;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .error-demo {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin: 1rem 0;
        }

        .success-demo {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin: 1rem 0;
        }

        .info-demo {
            background: rgba(23, 162, 184, 0.1);
            border-left: 4px solid #17a2b8;
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner"></div>
            <p class="mt-3">Cargando demo...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="demo-header">
        <div class="container">
            <h1><i class="fas fa-magic"></i> Sistema Avanzado de Tarjetas de Productos</h1>
            <p class="lead">Demostraci√≥n completa con lazy loading, animaciones y manejo de errores</p>
            <div class="mt-3">
                <span class="badge bg-success me-2">‚ú® Lazy Loading</span>
                <span class="badge bg-info me-2">üé® Animaciones CSS</span>
                <span class="badge bg-warning me-2">üîÑ Toggle Descriptions</span>
                <span class="badge bg-danger me-2">‚ö†Ô∏è Error Handling</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Panel de Control -->
        <div class="demo-controls">
            <h3><i class="fas fa-cogs"></i> Panel de Control de la Demo</h3>
            
            <!-- Selector de Templates -->
            <div class="demo-section">
                <h5>üé® Seleccionar Template</h5>
                <div class="template-selector">
                    <div class="template-option active" data-template="modern">
                        <i class="fas fa-star fa-2x mb-2 text-primary"></i>
                        <h6>Modern</h6>
                        <small>Dise√±o moderno con animaciones</small>
                    </div>
                    <div class="template-option" data-template="classic">
                        <i class="fas fa-th-large fa-2x mb-2 text-secondary"></i>
                        <h6>Cl√°sico</h6>
                        <small>Dise√±o tradicional y elegante</small>
                    </div>
                    <div class="template-option" data-template="minimal">
                        <i class="fas fa-square fa-2x mb-2 text-info"></i>
                        <h6>Minimal</h6>
                        <small>Dise√±o minimalista</small>
                    </div>
                </div>
            </div>

            <!-- Controles de Productos -->
            <div class="demo-section">
                <h5>üì¶ Gesti√≥n de Productos</h5>
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-primary-demo" id="loadProductsBtn">
                            <i class="fas fa-download"></i> Cargar Productos (Mock)
                        </button>
                        <button class="btn btn-secondary-demo" id="clearProductsBtn">
                            <i class="fas fa-trash"></i> Limpiar Grid
                        </button>
                        <button class="btn btn-warning-demo" id="shuffleProductsBtn">
                            <i class="fas fa-random"></i> Mezclar Orden
                        </button>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="number" class="form-control" id="productCountInput" 
                                   value="12" min="1" max="50" placeholder="Cantidad">
                            <button class="btn btn-primary-demo" id="generateProductsBtn">
                                <i class="fas fa-plus"></i> Generar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tests de Funcionalidad -->
            <div class="demo-section">
                <h5>üß™ Tests de Funcionalidad</h5>
                <button class="btn btn-primary-demo" id="testLazyLoadBtn">
                    <i class="fas fa-eye"></i> Test Lazy Loading
                </button>
                <button class="btn btn-primary-demo" id="testAnimationsBtn">
                    <i class="fas fa-magic"></i> Test Animaciones
                </button>
                <button class="btn btn-warning-demo" id="testErrorsBtn">
                    <i class="fas fa-exclamation-triangle"></i> Simular Errores
                </button>
                <button class="btn btn-secondary-demo" id="testPerformanceBtn">
                    <i class="fas fa-tachometer-alt"></i> Test Performance
                </button>
            </div>
        </div>

        <!-- Panel de Estad√≠sticas -->
        <div class="stats-panel">
            <div class="row">
                <div class="col-md-3">
                    <h6><i class="fas fa-boxes"></i> Productos Cargados</h6>
                    <h4 id="productCount">0</h4>
                </div>
                <div class="col-md-3">
                    <h6><i class="fas fa-eye"></i> Im√°genes Lazy</h6>
                    <h4 id="lazyImageCount">0</h4>
                </div>
                <div class="col-md-3">
                    <h6><i class="fas fa-expand"></i> Descripciones Expandidas</h6>
                    <h4 id="expandedDescriptions">0</h4>
                </div>
                <div class="col-md-3">
                    <h6><i class="fas fa-exclamation-triangle"></i> Errores Detectados</h6>
                    <h4 id="errorCount">0</h4>
                </div>
            </div>
        </div>

        <!-- Caracter√≠sticas Destacadas -->
        <div class="demo-section">
            <h3><i class="fas fa-stars"></i> Caracter√≠sticas Destacadas</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="feature-highlight">
                        <h5><i class="fas fa-rocket text-primary"></i> Lazy Loading Inteligente</h5>
                        <p>Carga progresiva de im√°genes con Intersection Observer API. Las im√°genes se cargan solo cuando est√°n cerca del viewport.</p>
                        <div class="success-demo">
                            ‚úÖ Mejora significativa en tiempo de carga inicial<br>
                            ‚úÖ Reduce el uso de ancho de banda<br>
                            ‚úÖ Optimizaci√≥n autom√°tica de memoria
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="feature-highlight">
                        <h5><i class="fas fa-magic text-warning"></i> Animaciones GPU</h5>
                        <p>Transiciones suaves aceleradas por GPU con CSS transforms. Hover effects y micro-interacciones elegantes.</p>
                        <div class="success-demo">
                            ‚úÖ 60fps en todas las animaciones<br>
                            ‚úÖ Aceleraci√≥n por GPU nativa<br>
                            ‚úÖ Respeta preferencias de motion reducido
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="feature-highlight">
                        <h5><i class="fas fa-expand-arrows-alt text-info"></i> Toggle de Descripciones</h5>
                        <p>Sistema avanzado para expandir/colapsar descripciones con estados persistentes en localStorage.</p>
                        <div class="success-demo">
                            ‚úÖ Animaciones suaves de expand/collapse<br>
                            ‚úÖ Estado persistente entre sesiones<br>
                            ‚úÖ Accesibilidad completa (ARIA)
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="feature-highlight">
                        <h5><i class="fas fa-shield-alt text-danger"></i> Manejo de Errores</h5>
                        <p>Sistema robusto de detecci√≥n, recuperaci√≥n autom√°tica y fallbacks para errores de DOM e im√°genes.</p>
                        <div class="success-demo">
                            ‚úÖ Recovery autom√°tico de errores<br>
                            ‚úÖ Fallbacks elegantes para im√°genes<br>
                            ‚úÖ Logging y analytics de errores
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid de Productos -->
        <div class="demo-section">
            <h3><i class="fas fa-th"></i> Grid de Productos</h3>
            <div class="info-demo">
                <strong>üí° Tip:</strong> Intenta hacer scroll, hover sobre las tarjetas, hacer clic en "Ver m√°s" y probar los botones de acci√≥n r√°pida.
            </div>
            <div class="products-container">
                <div class="product-grid" id="productGrid">
                    <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Log de Eventos -->
        <div class="demo-section">
            <h3><i class="fas fa-list"></i> Log de Eventos en Tiempo Real</h3>
            <div id="eventLog" style="background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 10px; height: 300px; overflow-y: auto; font-family: 'Courier New', monospace;">
                <div class="text-muted">Esperando eventos...</div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Nuestros scripts -->
    <script src="js/dom/ProductCardManager.js"></script>
    <script src="js/dom/DescriptionToggle.js"></script>
    <script src="js/dom/ErrorHandler.js"></script>
    
    <script>
        /**
         * üéØ DEMO SCRIPT - Orquestador principal de la demostraci√≥n
         */
        class ProductDemo {
            constructor() {
                this.currentTemplate = 'modern';
                this.isLoading = false;
                this.mockProducts = [];
                this.eventCount = 0;
                
                this.init();
            }

            init() {
                this.generateMockData();
                this.setupEventListeners();
                this.setupEventLogging();
                this.updateStats();
                this.hideLoading();
                
                this.log('üöÄ Demo inicializada correctamente');
            }

            generateMockData() {
                const categories = ['Jarros', 'Cuadernos', 'Yerberas', 'Decoraci√≥n'];
                const adjectives = ['Artesanal', 'Vintage', 'Moderno', 'Cl√°sico', 'Premium', 'Ecol√≥gico'];
                const materials = ['Cer√°mica', 'Madera', 'Metal', 'Bamb√∫', 'Vidrio'];
                
                this.mockProducts = Array.from({length: 50}, (_, i) => {
                    const category = categories[Math.floor(Math.random() * categories.length)];
                    const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
                    const material = materials[Math.floor(Math.random() * materials.length)];
                    const price = Math.floor(Math.random() * 5000) + 500;
                    const discount = Math.random() > 0.7 ? Math.floor(Math.random() * 30) + 10 : 0;
                    
                    return {
                        id: `demo-product-${i + 1}`,
                        name: `${adjective} ${category} de ${material}`,
                        shortDescription: `${category} ${adjective.toLowerCase()} ideal para uso diario.`,
                        longDescription: `
                            <p>Hermoso ${category.toLowerCase()} ${adjective.toLowerCase()} elaborado con ${material.toLowerCase()} de primera calidad.</p>
                            <p>Perfecto para quienes buscan combinar funcionalidad con est√©tica. Cada pieza es √∫nica y est√° dise√±ada para durar a√±os.</p>
                            <ul>
                                <li>Material: ${material} premium</li>
                                <li>Acabado: ${adjective.toLowerCase()}</li>
                                <li>Garant√≠a: 2 a√±os</li>
                                <li>Dise√±o ergon√≥mico</li>
                            </ul>
                        `,
                        price: price,
                        originalPrice: discount > 0 ? Math.floor(price / (1 - discount/100)) : null,
                        discount: discount,
                        image: `https://picsum.photos/300/350?random=${i + 1}`,
                        images: [
                            `https://picsum.photos/300/350?random=${i + 1}`,
                            `https://picsum.photos/300/350?random=${i + 51}`,
                            `https://picsum.photos/300/350?random=${i + 101}`
                        ],
                        rating: +(Math.random() * 2 + 3).toFixed(1),
                        reviewCount: Math.floor(Math.random() * 100) + 5,
                        stock: Math.floor(Math.random() * 50) + 1,
                        category: category,
                        tags: ['nuevo', adjective.toLowerCase(), material.toLowerCase()],
                        specifications: {
                            weight: `${Math.floor(Math.random() * 500) + 100}g`,
                            dimensions: `${Math.floor(Math.random() * 20) + 10}x${Math.floor(Math.random() * 20) + 10}cm`,
                            material: material
                        }
                    };
                });
            }

            setupEventListeners() {
                // Template selector
                document.querySelectorAll('.template-option').forEach(option => {
                    option.addEventListener('click', () => {
                        this.selectTemplate(option.dataset.template);
                    });
                });

                // Control buttons
                document.getElementById('loadProductsBtn').addEventListener('click', () => {
                    this.loadProducts();
                });

                document.getElementById('clearProductsBtn').addEventListener('click', () => {
                    this.clearProducts();
                });

                document.getElementById('shuffleProductsBtn').addEventListener('click', () => {
                    this.shuffleProducts();
                });

                document.getElementById('generateProductsBtn').addEventListener('click', () => {
                    const count = parseInt(document.getElementById('productCountInput').value) || 12;
                    this.generateProducts(count);
                });

                // Test buttons
                document.getElementById('testLazyLoadBtn').addEventListener('click', () => {
                    this.testLazyLoading();
                });

                document.getElementById('testAnimationsBtn').addEventListener('click', () => {
                    this.testAnimations();
                });

                document.getElementById('testErrorsBtn').addEventListener('click', () => {
                    this.testErrors();
                });

                document.getElementById('testPerformanceBtn').addEventListener('click', () => {
                    this.testPerformance();
                });
            }

            setupEventLogging() {
                // Log eventos de toggle de descripciones
                document.addEventListener('descriptionToggle', (e) => {
                    this.log(`üîÑ Descripci√≥n ${e.detail.isExpanded ? 'expandida' : 'colapsada'} - Producto: ${e.detail.productId}`);
                    this.updateStats();
                });

                // Log eventos del ProductCardManager
                document.addEventListener('productCardCreated', (e) => {
                    this.log(`‚ú® Tarjeta creada - ${e.detail.productId} (${e.detail.template})`);
                });

                document.addEventListener('lazyImageLoaded', (e) => {
                    this.log(`üñºÔ∏è Imagen cargada lazy - ${e.detail.src}`);
                    this.updateStats();
                });

                // Log eventos de errores
                document.addEventListener('errorHandled', (e) => {
                    this.log(`‚ö†Ô∏è Error manejado - ${e.detail.type}: ${e.detail.message}`, 'error');
                    this.updateStats();
                });

                // Log eventos de performance
                document.addEventListener('performanceMetric', (e) => {
                    this.log(`üìä M√©trica - ${e.detail.metric}: ${e.detail.value}ms`);
                });
            }

            selectTemplate(template) {
                this.currentTemplate = template;
                
                // Update UI
                document.querySelectorAll('.template-option').forEach(option => {
                    option.classList.remove('active');
                });
                document.querySelector(`[data-template="${template}"]`).classList.add('active');
                
                // Reload products with new template
                this.reloadProductsWithTemplate();
                
                this.log(`üé® Template cambiado a: ${template}`);
            }

            async loadProducts() {
                if (this.isLoading) return;
                
                this.showLoading();
                this.isLoading = true;

                try {
                    const count = Math.min(12, this.mockProducts.length);
                    const products = this.mockProducts.slice(0, count);
                    
                    const manager = window.ProductCardManager;
                    if (manager) {
                        await manager.renderProducts(products, this.currentTemplate);
                        this.log(`üì¶ ${products.length} productos cargados`);
                    } else {
                        throw new Error('ProductCardManager no disponible');
                    }
                } catch (error) {
                    this.log(`‚ùå Error cargando productos: ${error.message}`, 'error');
                } finally {
                    this.hideLoading();
                    this.isLoading = false;
                    this.updateStats();
                }
            }

            clearProducts() {
                const grid = document.getElementById('productGrid');
                grid.innerHTML = '';
                this.log('üßπ Grid limpiado');
                this.updateStats();
            }

            shuffleProducts() {
                const cards = Array.from(document.querySelectorAll('.product-card-container'));
                const grid = document.getElementById('productGrid');
                
                // Shuffle array
                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [cards[i], cards[j]] = [cards[j], cards[i]];
                }
                
                // Re-append in new order
                cards.forEach(card => grid.appendChild(card));
                
                this.log('üîÄ Productos mezclados');
            }

            async generateProducts(count) {
                if (this.isLoading) return;
                
                this.showLoading();
                this.isLoading = true;

                try {
                    const products = this.mockProducts.slice(0, count);
                    
                    const manager = window.ProductCardManager;
                    if (manager) {
                        await manager.renderProducts(products, this.currentTemplate);
                        this.log(`üé≤ ${count} productos generados`);
                    }
                } catch (error) {
                    this.log(`‚ùå Error generando productos: ${error.message}`, 'error');
                } finally {
                    this.hideLoading();
                    this.isLoading = false;
                    this.updateStats();
                }
            }

            async reloadProductsWithTemplate() {
                const existingCards = document.querySelectorAll('.product-card-container');
                if (existingCards.length === 0) return;

                this.showLoading();

                try {
                    // Extract product data from existing cards
                    const products = Array.from(existingCards).map(card => {
                        return this.mockProducts.find(p => p.id === card.dataset.productId);
                    }).filter(Boolean);

                    // Clear and reload
                    this.clearProducts();
                    
                    const manager = window.ProductCardManager;
                    if (manager) {
                        await manager.renderProducts(products, this.currentTemplate);
                    }
                } catch (error) {
                    this.log(`‚ùå Error recargando con template: ${error.message}`, 'error');
                } finally {
                    this.hideLoading();
                    this.updateStats();
                }
            }

            testLazyLoading() {
                this.log('üß™ Iniciando test de Lazy Loading...');
                
                // Scroll autom√°tico para activar lazy loading
                const cards = document.querySelectorAll('.product-card-container');
                if (cards.length > 0) {
                    let index = 0;
                    const scrollInterval = setInterval(() => {
                        if (index < cards.length) {
                            cards[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
                            index++;
                        } else {
                            clearInterval(scrollInterval);
                            this.log('‚úÖ Test de Lazy Loading completado');
                        }
                    }, 1000);
                } else {
                    this.log('‚ö†Ô∏è No hay productos para testear lazy loading');
                }
            }

            testAnimations() {
                this.log('üß™ Iniciando test de animaciones...');
                
                const cards = document.querySelectorAll('.product-card');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        // Simular hover
                        card.dispatchEvent(new MouseEvent('mouseenter'));
                        
                        setTimeout(() => {
                            card.dispatchEvent(new MouseEvent('mouseleave'));
                        }, 500);
                    }, index * 200);
                });
                
                setTimeout(() => {
                    this.log('‚úÖ Test de animaciones completado');
                }, cards.length * 200 + 1000);
            }

            testErrors() {
                this.log('üß™ Iniciando test de manejo de errores...');
                
                // Simular error de imagen
                const images = document.querySelectorAll('.card-image');
                if (images.length > 0) {
                    const randomImage = images[Math.floor(Math.random() * images.length)];
                    randomImage.src = 'https://invalid-url-404.jpg';
                    this.log('üñºÔ∏è Simulado error de carga de imagen');
                }

                // Simular error de DOM
                try {
                    const nonExistentElement = document.getElementById('non-existent-element');
                    nonExistentElement.innerHTML = 'This will cause an error';
                } catch (error) {
                    this.log('üö® Error de DOM simulado y capturado');
                }

                // Simular error de red
                fetch('https://invalid-api-endpoint-404.com/data')
                    .catch(error => {
                        this.log('üåê Error de red simulado');
                    });
            }

            async testPerformance() {
                this.log('üß™ Iniciando test de performance...');
                
                const startTime = performance.now();
                
                // Test de renderizado masivo
                const products = this.mockProducts.slice(0, 30);
                
                try {
                    const manager = window.ProductCardManager;
                    if (manager) {
                        await manager.renderProducts(products, this.currentTemplate);
                        
                        const endTime = performance.now();
                        const renderTime = endTime - startTime;
                        
                        this.log(`üìä Performance Test - Renderizado de 30 productos: ${renderTime.toFixed(2)}ms`);
                        
                        // Test de memoria
                        if ('memory' in performance) {
                            const memory = performance.memory;
                            this.log(`üß† Uso de memoria: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`);
                        }
                    }
                } catch (error) {
                    this.log(`‚ùå Error en test de performance: ${error.message}`, 'error');
                } finally {
                    this.updateStats();
                }
            }

            updateStats() {
                const productCount = document.querySelectorAll('.product-card-container').length;
                const lazyImages = document.querySelectorAll('.card-image[data-lazy="image"]').length;
                const expandedCount = window.DescriptionToggleManager ? 
                    Object.values(window.DescriptionToggleManager.getUsageStats()).filter(Boolean).length : 0;
                const errorCount = window.DOMErrorHandler ? 
                    window.DOMErrorHandler.getErrorStats().total : 0;

                document.getElementById('productCount').textContent = productCount;
                document.getElementById('lazyImageCount').textContent = lazyImages;
                document.getElementById('expandedDescriptions').textContent = expandedCount;
                document.getElementById('errorCount').textContent = errorCount;
            }

            log(message, type = 'info') {
                const logElement = document.getElementById('eventLog');
                const timestamp = new Date().toLocaleTimeString();
                const icon = {
                    'info': 'üí¨',
                    'error': '‚ùå',
                    'success': '‚úÖ',
                    'warning': '‚ö†Ô∏è'
                }[type] || 'üí¨';

                const logEntry = document.createElement('div');
                logEntry.style.marginBottom = '0.5rem';
                logEntry.innerHTML = `<span style="color: #718096;">[${timestamp}]</span> ${icon} ${message}`;
                
                logElement.appendChild(logEntry);
                logElement.scrollTop = logElement.scrollHeight;
                
                this.eventCount++;
                
                // Limpiar logs antiguos (mantener √∫ltimos 50)
                while (logElement.children.length > 50) {
                    logElement.removeChild(logElement.firstChild);
                }
            }

            showLoading() {
                document.getElementById('loadingOverlay').classList.add('show');
            }

            hideLoading() {
                setTimeout(() => {
                    document.getElementById('loadingOverlay').classList.remove('show');
                }, 300);
            }
        }

        // Inicializar demo cuando todo est√© listo
        let demo;
        
        function initDemo() {
            // Esperar a que todos los managers est√©n listos
            const checkManagers = setInterval(() => {
                if (window.ProductCardManager && window.DescriptionToggleManager && window.DOMErrorHandler) {
                    clearInterval(checkManagers);
                    demo = new ProductDemo();
                    console.log('üéØ Demo completamente inicializada');
                }
            }, 100);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDemo);
        } else {
            initDemo();
        }
    </script>
</body>
</html>